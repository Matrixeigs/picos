

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Examples from Optimal Experimental Design &mdash; picos 0.1.2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="picos 0.1.2 documentation" href="index.html" />
    <link rel="up" title="Examples" href="examples.html" />
    <link rel="next" title="Cut problems in graphs" href="graphs.html" />
    <link rel="prev" title="Examples" href="examples.html" /> 


  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33037163-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>



  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33037163-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>



  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33037163-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>



  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-33037163-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>

  </head>
<body><div class="admonition warning"><p class="first admonition-title">Warning</p><p class="last">You are consulting the doc of a former version of PICOS.The latest version is <a href="../index.html">HERE</a>. </p></div>    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="graphs.html" title="Cut problems in graphs"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Examples"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">PICOS</a> &raquo;</li>
          <li><a href="examples.html" accesskey="U">Examples</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="examples-from-optimal-experimental-design">
<span id="optdes"></span><h1>Examples from Optimal Experimental Design<a class="headerlink" href="#examples-from-optimal-experimental-design" title="Permalink to this headline">Â¶</a></h1>
<p>Optimal experimental design is a theory
at the interface of statistics and optimization,
which studies how to allocate some experimental
effort within a set of available expeiments.
The goal is to allow for the best possible
estimation of an unknown parameter <img class="math" src="_images/math/52e8ed7a3ba22130ad3984eb2cd413406475a689.png" alt="\theta"/>.
In what follows, we assume the standard linear model with
multiresponse experiments: the <img class="math" src="_images/math/f7d487353ad46311dbe60e1d74c3403579ed5dde.png" alt="i^{\textrm{th}}"/>
experiment gives a multidimensional observation that
can be written as <img class="math" src="_images/math/721a890f8ccfffd11e0ebf16f74b6e1d10a46c06.png" alt="y_i = A_i^T \theta+\epsilon_i"/>,
where <img class="math" src="_images/math/6e6ceb79ebc4bf613298e0144eae25dd73de9be3.png" alt="y_i"/> is of dimension <img class="math" src="_images/math/74949574eb3bb72bd595192b9685db088e6a44bd.png" alt="l_i"/>,
<img class="math" src="_images/math/2744600189f7f1df31756f2022b2d5212ef1c767.png" alt="A_i"/> is a <img class="math" src="_images/math/e809f220a3dcc25a10864259b04071cb3ee05788.png" alt="m \times l_i-"/> matrix,
and the noise vectors <img class="math" src="_images/math/319593f7ae7122d7910bdf87a156b25f7588f1ad.png" alt="\epsilon_i"/> are i.i.d. with a unit variance.</p>
<p>Several optimization criterions exist, leading to different SDP, SOCP and LP
formulations.
As such, optimal experimental design problens are natural examples for problems
in conic optimization. For a review of the different formulations
and more references, see <a class="reference internal" href="#optdes-refs"><em>[1]</em></a>.</p>
<p>The code below initializes the data used in all the examples of this page.
It should be run prior to any of the codes presented in this page.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">cvxopt</span> <span class="kn">as</span> <span class="nn">cvx</span>
<span class="kn">import</span> <span class="nn">picos</span> <span class="kn">as</span> <span class="nn">pic</span>

<span class="c">#---------------------------------#</span>
<span class="c"># First generate some data :      #</span>
<span class="c">#       _ a list of 8 matrices A  #</span>
<span class="c">#       _ a vector c              #</span>
<span class="c">#---------------------------------#</span>
<span class="n">A</span><span class="o">=</span><span class="p">[</span> <span class="n">cvx</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]),</span>
<span class="n">cvx</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]]),</span>
<span class="n">cvx</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]),</span>
<span class="n">cvx</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]]),</span>
<span class="n">cvx</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]]),</span>
<span class="n">cvx</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]]),</span>
<span class="n">cvx</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]]),</span>
<span class="n">cvx</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
<span class="p">]</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">cvx</span><span class="o">.</span><span class="n">matrix</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
<div class="section" id="c-optimality-multi-response-socp">
<h2>c-optimality, multi-response: SOCP<a class="headerlink" href="#c-optimality-multi-response-socp" title="Permalink to this headline">Â¶</a></h2>
<p>We compute the c-optimal design (<tt class="docutils literal"><span class="pre">c=[1,2,3,4,5]</span></tt>)
for the observation matrices <tt class="docutils literal"><span class="pre">A[i].T</span></tt> from the variable <tt class="docutils literal"><span class="pre">A</span></tt> defined above.
The results below suggest that we should allocate 12.8% of the
experimental effort on experiment #5, and 87.2% on experiment #7.</p>
<div class="section" id="primal-problem">
<h3>Primal Problem<a class="headerlink" href="#primal-problem" title="Permalink to this headline">Â¶</a></h3>
<p>The SOCP for multiresponse c-optimal design is:</p>
<div class="math">
<p><img src="_images/math/3c68042f7674ccf1f4325cc80ddf01b1d46d4f3f.png" alt="\begin{center}
\begin{eqnarray*}
&amp;\underset{\substack{\mu \in \mathbb{R}^s\\
                     \forall i \in [s],\ z_i \in \mathbb{R}^{l_i}}}{\mbox{minimize}}
                   &amp; \sum_{i=1}^s \mu_i\\
&amp;\mbox{subject to} &amp; \sum_{i=1}^s A_i z_i = c\\
&amp;                  &amp; \forall i \in [s],\ \Vert z_i \Vert_2 \leq \mu_i,
\end{eqnarray*}
\end{center}"/></p>
</div><div class="highlight-python"><div class="highlight"><pre><span class="c">#create the problem, variables and params</span>
<span class="n">prob_primal_c</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<span class="n">AA</span><span class="o">=</span><span class="p">[</span><span class="n">cvx</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">tc</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span> <span class="c">#each AA[i].T is a 3 x 5 observation matrix</span>
<span class="n">s</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">AA</span><span class="p">)</span>
<span class="n">AA</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">)</span>
<span class="n">cc</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="n">prob_primal_c</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;z[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
<span class="n">mu</span><span class="o">=</span><span class="n">prob_primal_c</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;mu&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

<span class="c">#define the constraints and objective function</span>
<span class="n">prob_primal_c</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&lt;</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#constraints</span>
        <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
        <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
        <span class="p">)</span>
<span class="n">prob_primal_c</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
        <span class="n">pic</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="p">[</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#summands</span>
                <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
                <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
                <span class="p">)</span>
        <span class="o">==</span> <span class="n">cc</span> <span class="p">)</span>
<span class="n">prob_primal_c</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="s">&#39;min&#39;</span><span class="p">,</span><span class="mi">1</span><span class="o">|</span><span class="n">mu</span><span class="p">)</span>

<span class="c">#solve the problem and retrieve the optimal weights of the optimal design.</span>
<span class="k">print</span> <span class="n">prob_primal_c</span>
<span class="n">prob_primal_c</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">solver</span><span class="o">=</span><span class="s">&#39;cvxopt&#39;</span><span class="p">)</span>

<span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="o">.</span><span class="n">value</span>
<span class="n">w</span><span class="o">=</span><span class="n">mu</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="c">#normalize mu to get the optimal weights</span>
<span class="k">print</span>
<span class="k">print</span> <span class="s">&#39;The optimal deign is:&#39;</span>
<span class="k">print</span> <span class="n">w</span>
</pre></div>
</div>
<p>Generated output:</p>
<div class="highlight-none"><div class="highlight"><pre>---------------------
optimization problem  (SOCP):
32 variables, 5 affine constraints, 32 vars in 8 SO cones

z   : list of 8 variables, (3, 1), continuous
mu  : (8, 1), continuous

        minimize â© |1| | mu âª
such that
||z[i]|| &lt; mu[i] for all i in [s]
Î£_{i in [s]} A[i]*z[i] = c
---------------------

The optimal deign is:
[...]
[...]
[...]
[...]
[ 1.28e-01]
[...]
[ 8.72e-01]
[...]
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">[...]</span></tt> above indicate a numerical zero entry
(<em>i.e., which can be something like 2.84e-10</em>).
We use the ellipsis <tt class="docutils literal"><span class="pre">...</span></tt> instead for clarity and compatibility with <strong>doctest</strong>.</p>
</div>
<div class="section" id="dual-problem">
<h3>Dual Problem<a class="headerlink" href="#dual-problem" title="Permalink to this headline">Â¶</a></h3>
<p>This is only to check that we obtain the same solution with the dual problem,
and to provide one additional example in this doc:</p>
<div class="math">
<p><img src="_images/math/9dc6325052d3769629d243b172d324cff48db715.png" alt="\begin{center}
\begin{eqnarray*}
&amp;\underset{u \in \mathbb{R}^m}{\mbox{maximize}}
                   &amp; c^T u\\
&amp;\mbox{subject to} &amp; \forall i \in [s],\ \Vert A_i^T u \Vert_2 \leq 1
\end{eqnarray*}
\end{center}"/></p>
</div><div class="highlight-python"><div class="highlight"><pre><span class="c">#create the problem, variables and params</span>
<span class="n">prob_dual_c</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<span class="n">AA</span><span class="o">=</span><span class="p">[</span><span class="n">cvx</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">tc</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span> <span class="c">#each AA[i].T is a 3 x 5 observation matrix</span>
<span class="n">s</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">AA</span><span class="p">)</span>
<span class="n">AA</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">)</span>
<span class="n">cc</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<span class="n">u</span><span class="o">=</span><span class="n">prob_dual_c</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<span class="c">#define the constraints and objective function</span>
<span class="n">prob_dual_c</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#constraints</span>
        <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
        <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
        <span class="p">)</span>
<span class="n">prob_dual_c</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="s">&#39;max&#39;</span><span class="p">,</span> <span class="n">cc</span><span class="o">|</span><span class="n">u</span><span class="p">)</span>

<span class="c">#solve the problem and retrieve the weights of the optimal design</span>
<span class="k">print</span> <span class="n">prob_dual_c</span>
<span class="n">prob_dual_c</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="n">cons</span><span class="o">.</span><span class="n">dual</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="n">prob_dual_c</span><span class="o">.</span><span class="n">get_constraint</span><span class="p">((</span><span class="mi">0</span><span class="p">,))]</span> <span class="c">#Lagrangian duals of the SOC constraints</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">cvx</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
<span class="n">w</span><span class="o">=</span><span class="n">mu</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="c">#normalize mu to get the optimal weights</span>
<span class="k">print</span>
<span class="k">print</span> <span class="s">&#39;The optimal deign is:&#39;</span>
<span class="k">print</span> <span class="n">w</span>
</pre></div>
</div>
<p>Generated output:</p>
<div class="highlight-none"><div class="highlight"><pre>---------------------
optimization problem  (SOCP):
5 variables, 0 affine constraints, 32 vars in 8 SO cones

u   : (5, 1), continuous

        maximize â© c | u âª
such that
||A[i].T*u|| &lt; 1 for all i in [s]
---------------------

The optimal deign is:
[...]
[...]
[...]
[...]
[ 1.28e-01]
[...]
[ 8.72e-01]
[...]
</pre></div>
</div>
</div>
</div>
<div class="section" id="c-optimality-single-response-lp">
<h2>c-optimality, single-response: LP<a class="headerlink" href="#c-optimality-single-response-lp" title="Permalink to this headline">Â¶</a></h2>
<p>When the observation matrices are row vectors (single-response framework),
the SOCP above reduces to a simple LP, because the variables
<img class="math" src="_images/math/7532b41a34c9ca592694135d1de65eeb8d9ce036.png" alt="z_i"/> are scalar.
We solve below the LP for the case where there are 12
available experiments, corresponding to the columns of the matrices
<tt class="docutils literal"><span class="pre">A[4]</span></tt>, <tt class="docutils literal"><span class="pre">A[5]</span></tt>, <tt class="docutils literal"><span class="pre">A[6]</span></tt>, and <tt class="docutils literal"><span class="pre">A[7]</span></tt> defined in the preambule.</p>
<p>The optimal design allocates 3.37% to experiment #5 (2nd column of <tt class="docutils literal"><span class="pre">A[5]</span></tt>),
27.9% to experiment #7 (1st column of <tt class="docutils literal"><span class="pre">A[6]</span></tt>),
11.8% to experiment #8 (2nd column of <tt class="docutils literal"><span class="pre">A[6]</span></tt>),
27.6% to experiment #9 (3rd column of <tt class="docutils literal"><span class="pre">A[6]</span></tt>),
and 29.3% to experiment #11 (2nd column of <tt class="docutils literal"><span class="pre">A[7]</span></tt>).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#create the problem, variables and params</span>
<span class="n">prob_LP</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<span class="n">AA</span><span class="o">=</span><span class="p">[</span><span class="n">cvx</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">tc</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">:]]</span> <span class="c">#12 column vectors</span>
<span class="n">s</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">AA</span><span class="p">)</span>
<span class="n">AA</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">)</span>
<span class="n">cc</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="n">prob_LP</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;z[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
<span class="n">mu</span><span class="o">=</span><span class="n">prob_LP</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;mu&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

<span class="c">#define the constraints and objective function</span>
<span class="n">prob_LP</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&lt;</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#constraints handled as -mu_i &lt; z_i&lt; mu_i</span>
        <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
        <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
        <span class="p">)</span>
<span class="n">prob_LP</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
        <span class="n">pic</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
                <span class="p">[</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#summands</span>
                <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
                <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
                <span class="p">)</span>
        <span class="o">==</span> <span class="n">cc</span> <span class="p">)</span>
<span class="n">prob_LP</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="s">&#39;min&#39;</span><span class="p">,</span><span class="mi">1</span><span class="o">|</span><span class="n">mu</span><span class="p">)</span>

<span class="c">#solve the problem and retrieve the weights of the optimal design</span>
<span class="k">print</span> <span class="n">prob_LP</span>
<span class="n">prob_LP</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="o">.</span><span class="n">value</span>
<span class="n">w</span><span class="o">=</span><span class="n">mu</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="c">#normalize mu to get the optimal weights</span>
<span class="k">print</span>
<span class="k">print</span> <span class="s">&#39;The optimal deign is:&#39;</span>
<span class="k">print</span> <span class="n">w</span>
</pre></div>
</div>
<p>Note that there are no cone constraints, because
the constraints of the form <img class="math" src="_images/math/8f93a56a4013dba6d035ba4deb803ff492aab2e6.png" alt="|z_i| \leq \mu_i"/> are handled as two
inequalities when <img class="math" src="_images/math/7532b41a34c9ca592694135d1de65eeb8d9ce036.png" alt="z_i"/> is scalar, so the problem is a LP indeed:</p>
<div class="highlight-none"><div class="highlight"><pre>---------------------
optimization problem  (LP):
24 variables, 29 affine constraints

z   : list of 12 variables, (1, 1), continuous
mu  : (12, 1), continuous

        minimize â© |1| | mu âª
such that
||z[i]|| &lt; mu[i] for all i in [s]
Î£_{i in [s]} A[i]*z[i] = c
---------------------

The optimal deign is:
[...]
[...]
[...]
[...]
[ 3.37e-02]
[...]
[ 2.79e-01]
[ 1.18e-01]
[ 2.76e-01]
[...]
[ 2.93e-01]
[...]
</pre></div>
</div>
</div>
<div class="section" id="sdp-formulation-of-the-c-optimal-design-problem">
<h2>SDP formulation of the c-optimal design problem<a class="headerlink" href="#sdp-formulation-of-the-c-optimal-design-problem" title="Permalink to this headline">Â¶</a></h2>
<p>We give below the SDP for c-optimality, in primal and dual
form. You can observe that we obtain the same results as
with the SOCP presented earlier:
12.8% on experiment #5, and 87.2% on experiment #7.</p>
<div class="section" id="id1">
<h3>Primal Problem<a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h3>
<p>The SDP formulation of the c-optimal design problem is:</p>
<div class="math">
<p><img src="_images/math/5a77a6985be9df2826eee65a654fa5e9bc2c69f8.png" alt="\begin{center}
\begin{eqnarray*}
&amp;\underset{\mu \in \mathbb{R}^s}{\mbox{minimize}}
                   &amp; \sum_{i=1}^s \mu_i\\
&amp;\mbox{subject to} &amp; \sum_{i=1}^s \mu_i A_i A_i^T \succeq c c^T,\\
&amp;                  &amp; \mu \geq 0.
\end{eqnarray*}
\end{center}"/></p>
</div><div class="highlight-python"><div class="highlight"><pre><span class="c">#create the problem, variables and params</span>
<span class="n">prob_SDP_c_primal</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<span class="n">AA</span><span class="o">=</span><span class="p">[</span><span class="n">cvx</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">tc</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span> <span class="c">#each AA[i].T is a 3 x 5 observation matrix</span>
<span class="n">s</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">AA</span><span class="p">)</span>
<span class="n">AA</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">)</span>
<span class="n">cc</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<span class="n">mu</span><span class="o">=</span><span class="n">prob_SDP_c_primal</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;mu&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

<span class="c">#define the constraints and objective function</span>
<span class="n">prob_SDP_c_primal</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
        <span class="n">pic</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
        <span class="p">[</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#summands</span>
        <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
        <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
        <span class="p">)</span>
        <span class="o">&gt;&gt;</span> <span class="n">cc</span><span class="o">*</span><span class="n">cc</span><span class="o">.</span><span class="n">T</span> <span class="p">)</span>
<span class="n">prob_SDP_c_primal</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">mu</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
<span class="n">prob_SDP_c_primal</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="s">&#39;min&#39;</span><span class="p">,</span><span class="mi">1</span><span class="o">|</span><span class="n">mu</span><span class="p">)</span>

<span class="c">#solve the problem and retrieve the weights of the optimal design</span>
<span class="k">print</span> <span class="n">prob_SDP_c_primal</span>
<span class="n">prob_SDP_c_primal</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">w</span><span class="o">=</span><span class="n">mu</span><span class="o">.</span><span class="n">value</span>
<span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="c">#normalize mu to get the optimal weights</span>
<span class="k">print</span>
<span class="k">print</span> <span class="s">&#39;The optimal deign is:&#39;</span>
<span class="k">print</span> <span class="n">w</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>---------------------
optimization problem  (SDP):
8 variables, 8 affine constraints, 15 vars in 1 SD cones

mu  : (8, 1), continuous

        minimize â© |1| | mu âª
such that
Î£_{i in [s]} mu[i]*A[i]*A[i].T â½ c*c.T
mu &gt; |0|
---------------------

The optimal deign is:
[...]
[...]
[...]
[...]
[ 1.28e-01]
[...]
[ 8.72e-01]
[...]
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3>Dual Problem<a class="headerlink" href="#id2" title="Permalink to this headline">Â¶</a></h3>
<p>This is only to check that we obtain the same solution with the dual problem,
and to provide one additional example in this doc:</p>
<div class="math">
<p><img src="_images/math/388e638c5babbe1dbda8ba920371ca3d17c59598.png" alt="\begin{center}
\begin{eqnarray*}
&amp;\underset{X \in \mathbb{R}^{m \times m}}{\mbox{maximize}}
                   &amp;  c^T X c\\
&amp;\mbox{subject to} &amp; \forall i \in [s],\ \langle A_i A_i^T,\ X \rangle \leq 1,\\
&amp;                  &amp;  X \succeq 0.
\end{eqnarray*}
\end{center}"/></p>
</div><div class="highlight-python"><div class="highlight"><pre><span class="c">#create the problem, variables and params</span>
<span class="n">prob_SDP_c_dual</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<span class="n">AA</span><span class="o">=</span><span class="p">[</span><span class="n">cvx</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">tc</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span> <span class="c">#each AA[i].T is a 3 x 5 observation matrix</span>
<span class="n">s</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">AA</span><span class="p">)</span>
<span class="n">AA</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">)</span>
<span class="n">cc</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">X</span><span class="o">=</span><span class="n">prob_SDP_c_dual</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">,(</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">),</span><span class="n">vtype</span><span class="o">=</span><span class="s">&#39;symmetric&#39;</span><span class="p">)</span>

<span class="c">#define the constraints and objective function</span>
<span class="n">prob_SDP_c_dual</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">|</span> <span class="n">X</span> <span class="p">)</span> <span class="o">&lt;</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#constraints</span>
        <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
        <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
        <span class="p">)</span>
<span class="n">prob_SDP_c_dual</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">X</span><span class="o">&gt;&gt;</span><span class="mi">0</span><span class="p">)</span>
<span class="n">prob_SDP_c_dual</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="s">&#39;max&#39;</span><span class="p">,</span> <span class="n">cc</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="n">cc</span><span class="p">)</span>

<span class="c">#solve the problem and retrieve the weights of the optimal design</span>
<span class="k">print</span> <span class="n">prob_SDP_c_dual</span>
<span class="n">prob_SDP_c_dual</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">solver</span><span class="o">=</span><span class="s">&#39;smcp&#39;</span><span class="p">)</span>
<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="n">cons</span><span class="o">.</span><span class="n">dual</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="n">prob_SDP_c_dual</span><span class="o">.</span><span class="n">get_constraint</span><span class="p">((</span><span class="mi">0</span><span class="p">,))]</span> <span class="c">#Lagrangian duals of the SOC constraints</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">cvx</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
<span class="n">w</span><span class="o">=</span><span class="n">mu</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="c">#normalize mu to get the optimal weights</span>
<span class="k">print</span>
<span class="k">print</span> <span class="s">&#39;The optimal deign is:&#39;</span>
<span class="k">print</span> <span class="n">w</span>
<span class="k">print</span> <span class="s">&#39;and the optimal positive semidefinite matrix X is&#39;</span>
<span class="k">print</span> <span class="n">X</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>---------------------
optimization problem  (SDP):
15 variables, 8 affine constraints, 15 vars in 1 SD cones

X   : (5, 5), symmetric

        maximize c.T*X*c
such that
â© A[i]*A[i].T | X âª &lt; 1.0 for all i in [s]
X â½ |0|
---------------------

The optimal deign is:
[...]
[...]
[...]
[...]
[ 1.28e-01]
[...]
[ 8.72e-01]
[...]

and the optimal positive semidefinite matrix X is
[ 5.92e-03  8.98e-03  2.82e-03 -3.48e-02 -1.43e-02]
[ 8.98e-03  1.36e-02  4.27e-03 -5.28e-02 -2.17e-02]
[ 2.82e-03  4.27e-03  1.34e-03 -1.66e-02 -6.79e-03]
[-3.48e-02 -5.28e-02 -1.66e-02  2.05e-01  8.39e-02]
[-1.43e-02 -2.17e-02 -6.79e-03  8.39e-02  3.44e-02]
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-optimality-socp">
<h2>A-optimality: SOCP<a class="headerlink" href="#a-optimality-socp" title="Permalink to this headline">Â¶</a></h2>
<p>We compute the A-optimal design
for the observation matrices <tt class="docutils literal"><span class="pre">A[i].T</span></tt> defined in the preambule.
The optimal design allocates
24.9% on experiment #3,
14.2% on experiment #4,
8.51% on experiment #5,
12.1% on experiment #6,
13.2% on experiment #7,
and 27.0% on experiment #8.</p>
<blockquote>
<div>[ 2.49e-01]
[ 1.42e-01]
[ 8.51e-02]
[ 1.21e-01]
[ 1.32e-01]
[ 2.70e-01]</div></blockquote>
<div class="section" id="id3">
<h3>Primal Problem<a class="headerlink" href="#id3" title="Permalink to this headline">Â¶</a></h3>
<p>The SOCP for the A-optimal design problem is:</p>
<div class="math">
<p><img src="_images/math/d79f7b166b40d8ee6cbff20e543afeada0e962af.png" alt="\begin{center}
\begin{eqnarray*}
&amp;\underset{\substack{\mu \in \mathbb{R}^s\\
                     \forall i \in [s],\ Z_i \in \mathbb{R}^{l_i \times m}}}{\mbox{minimize}}
                   &amp; \sum_{i=1}^s \mu_i\\
&amp;\mbox{subject to} &amp; \sum_{i=1}^s A_i Z_i = I\\
&amp;                  &amp; \forall i \in [s],\ \Vert Z_i \Vert_F \leq \mu_i,
\end{eqnarray*}
\end{center}"/></p>
</div><div class="highlight-python"><div class="highlight"><pre><span class="c">#create the problem, variables and params</span>
<span class="n">prob_primal_A</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<span class="n">AA</span><span class="o">=</span><span class="p">[</span><span class="n">cvx</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">tc</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span> <span class="c">#each AA[i].T is a 3 x 5 observation matrix</span>
<span class="n">s</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">AA</span><span class="p">)</span>
<span class="n">AA</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">)</span>
<span class="n">Z</span><span class="o">=</span><span class="p">[</span><span class="n">prob_primal_A</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;Z[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
<span class="n">mu</span><span class="o">=</span><span class="n">prob_primal_A</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;mu&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

<span class="c">#define the constraints and objective function</span>
<span class="n">prob_primal_A</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&lt;</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#constraints</span>
        <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
        <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
        <span class="p">)</span>
<span class="n">prob_primal_A</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
        <span class="n">pic</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
        <span class="p">[</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#summands</span>
        <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
        <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
        <span class="p">)</span>
        <span class="o">==</span> <span class="s">&#39;I&#39;</span> <span class="p">)</span>
<span class="n">prob_primal_A</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="s">&#39;min&#39;</span><span class="p">,</span><span class="mi">1</span><span class="o">|</span><span class="n">mu</span><span class="p">)</span>

<span class="c">#solve the problem and retrieve the weights of the optimal design</span>
<span class="k">print</span> <span class="n">prob_primal_A</span>
<span class="n">prob_primal_A</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">w</span><span class="o">=</span><span class="n">mu</span><span class="o">.</span><span class="n">value</span>
<span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="c">#normalize mu to get the optimal weights</span>
<span class="k">print</span>
<span class="k">print</span> <span class="s">&#39;The optimal deign is:&#39;</span>
<span class="k">print</span> <span class="n">w</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>---------------------
optimization problem  (SOCP):
128 variables, 25 affine constraints, 128 vars in 8 SO cones

Z   : list of 8 variables, (3, 5), continuous
mu  : (8, 1), continuous

        minimize â© |1| | mu âª
such that
||Z[i]|| &lt; mu[i] for all i in [s]
Î£_{i in [s]} A[i]*Z[i] = I
---------------------

The optimal deign is:
[...]
[...]
[ 2.49e-01]
[ 1.42e-01]
[ 8.51e-02]
[ 1.21e-01]
[ 1.32e-01]
[ 2.70e-01]
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>Dual Problem<a class="headerlink" href="#id4" title="Permalink to this headline">Â¶</a></h3>
<p>This is only to check that we obtain the same solution with the dual problem,
and to provide one additional example in this doc:</p>
<div class="math">
<p><img src="_images/math/111aacbe2b7f456d6b13c33b493c9cd7d208c425.png" alt="\begin{center}
\begin{eqnarray*}
&amp;\underset{U \in \mathbb{R}^{m \times m}}{\mbox{maximize}}
                   &amp;  \mbox{trace}\ U\\
&amp;\mbox{subject to} &amp; \forall i \in [s],\ \Vert A_i^T U \Vert_2 \leq 1
\end{eqnarray*}
\end{center}"/></p>
</div><div class="highlight-python"><div class="highlight"><pre><span class="c">#create the problem, variables and params</span>
<span class="n">prob_dual_A</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<span class="n">AA</span><span class="o">=</span><span class="p">[</span><span class="n">cvx</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">tc</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span> <span class="c">#each AA[i].T is a 3 x 5 observation matrix</span>
<span class="n">s</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">AA</span><span class="p">)</span>
<span class="n">m</span><span class="o">=</span><span class="n">AA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">AA</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">)</span>
<span class="n">U</span><span class="o">=</span><span class="n">prob_dual_A</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;U&#39;</span><span class="p">,(</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">))</span>

<span class="c">#define the constraints and objective function</span>
<span class="n">prob_dual_A</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">U</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#constraints</span>
        <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
        <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
        <span class="p">)</span>
<span class="n">prob_dual_A</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="s">&#39;max&#39;</span><span class="p">,</span> <span class="s">&#39;I&#39;</span><span class="o">|</span><span class="n">U</span><span class="p">)</span>

<span class="c">#solve the problem and retrieve the weights of the optimal design</span>
<span class="k">print</span> <span class="n">prob_dual_A</span>
<span class="n">prob_dual_A</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="n">cons</span><span class="o">.</span><span class="n">dual</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">cons</span> <span class="ow">in</span> <span class="n">prob_dual_A</span><span class="o">.</span><span class="n">get_constraint</span><span class="p">((</span><span class="mi">0</span><span class="p">,))]</span> <span class="c">#Lagrangian duals of the SOC constraints</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">cvx</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
<span class="n">w</span><span class="o">=</span><span class="n">mu</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span> <span class="c">#normalize mu to get the optimal weights</span>
<span class="k">print</span>
<span class="k">print</span> <span class="s">&#39;The optimal deign is:&#39;</span>
<span class="k">print</span> <span class="n">w</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>---------------------
optimization problem  (SOCP):
25 variables, 0 affine constraints, 128 vars in 8 SO cones

U   : (5, 5), continuous

        maximize trace( U )
such that
||A[i].T*U|| &lt; 1 for all i in [s]
---------------------

The optimal deign is:
[...]
[...]
[ 2.49e-01]
[ 1.42e-01]
[ 8.51e-02]
[ 1.21e-01]
[ 1.32e-01]
[ 2.70e-01]
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-optimality-with-multiple-constraints-socp">
<h2>A-optimality with multiple constraints: SOCP<a class="headerlink" href="#a-optimality-with-multiple-constraints-socp" title="Permalink to this headline">Â¶</a></h2>
<p>A-optimal designs can also be computed by SOCP
when the vector of weights <img class="math" src="_images/math/fe8742a5c8740bebb644bf5f3fdcadae1a4ecf0c.png" alt="\mathbf{w}"/> is subject
to several linear constraints.
To give an example, we compute the A-optimal design for
the observation matrices given in the preambule, when the weights
must satisfy: <img class="math" src="_images/math/69bd63f386b912ebe4c41fb0502044635773ffca.png" alt="\sum_{i=0}^3 w_i \leq 0.5"/> and <img class="math" src="_images/math/a1141c616f0273794821495ace5b14541beea719.png" alt="\sum_{i=4}^7 w_i \leq 0.5"/>.
This problem has the following SOCP formulation:</p>
<div class="math">
<p><img src="_images/math/fdc82bd5573eeb5a7eb3e936804d29e228612380.png" alt="\begin{center}
\begin{eqnarray*}
&amp;\underset{\substack{\mathbf{w} \in \mathbb{R}^s\\
                     \mu \in \mathbb{R}^s\\
                     \forall i \in [s],\ Z_i \in \mathbb{R}^{l_i \times m}}}{\mbox{minimize}}
                   &amp; \sum_{i=1}^s \mu_i\\
&amp;\mbox{subject to} &amp; \sum_{i=1}^s A_i Z_i = I\\
&amp;                  &amp; \sum_{i=0}^3 w_i \leq 0.5\\
&amp;                  &amp; \sum_{i=4}^7 w_i \leq 0.5\\
&amp;                  &amp; \forall i \in [s],\ \Vert Z_i \Vert_F^2 \leq \mu_i w_i,
\end{eqnarray*}
\end{center}"/></p>
</div><p>The optimal solution allocates 29.7% and 20.3% to the experiments #3 and #4,
and  respectively 6.54%, 11.9%, 9.02% and 22.5% to the experiments #5 to #8:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#create the problem, variables and params</span>
<span class="n">prob_A_multiconstraints</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<span class="n">AA</span><span class="o">=</span><span class="p">[</span><span class="n">cvx</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">tc</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span> <span class="c">#each AA[i].T is a 3 x 5 observation matrix</span>
<span class="n">s</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">AA</span><span class="p">)</span>
<span class="n">AA</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">)</span>

<span class="n">mu</span><span class="o">=</span><span class="n">prob_A_multiconstraints</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;mu&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span><span class="n">prob_A_multiconstraints</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
<span class="n">Z</span><span class="o">=</span><span class="p">[</span><span class="n">prob_A_multiconstraints</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;Z[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>

<span class="c">#define the constraints and objective function</span>
<span class="n">prob_A_multiconstraints</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
        <span class="n">pic</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
        <span class="p">[</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#summands</span>
        <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
        <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
        <span class="p">)</span>
        <span class="o">==</span> <span class="s">&#39;I&#39;</span> <span class="p">)</span>
<span class="n">prob_A_multiconstraints</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span> <span class="p">(</span><span class="mi">1</span><span class="o">|</span><span class="n">w</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">prob_A_multiconstraints</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span> <span class="p">(</span><span class="mi">1</span><span class="o">|</span><span class="n">w</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">prob_A_multiconstraints</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">(</span>
                <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">&lt;</span><span class="n">mu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="s">&#39;[s]&#39;</span><span class="p">)</span>
<span class="n">prob_A_multiconstraints</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="s">&#39;min&#39;</span><span class="p">,</span><span class="mi">1</span><span class="o">|</span><span class="n">mu</span><span class="p">)</span>

<span class="c">#solve the problem and retrieve the weights of the optimal design</span>
<span class="k">print</span> <span class="n">prob_A_multiconstraints</span>
<span class="n">prob_A_multiconstraints</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="o">.</span><span class="n">value</span>
<span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="c">#normalize w to get the optimal weights</span>
<span class="k">print</span>
<span class="k">print</span> <span class="s">&#39;The optimal deign is:&#39;</span>
<span class="k">print</span> <span class="n">w</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>---------------------
optimization problem  (SOCP):
136 variables, 27 affine constraints, 136 vars in 8 SO cones

Z   : list of 8 variables, (3, 5), continuous
mu  : (8, 1), continuous
w   : (8, 1), continuous

        minimize â© |1| | mu âª
such that
Î£_{i in [s]} A[i]*Z[i] = I
â© |1| | w[:4] âª &lt; 0.5
â© |1| | w[4:] âª &lt; 0.5
||Z[i]||^2 &lt; ( mu[i])( w[i]) for all i in [s]
---------------------

The optimal deign is:
[...]
[...]
[ 2.97e-01]
[ 2.03e-01]
[ 6.54e-02]
[ 1.19e-01]
[ 9.02e-02]
[ 2.25e-01]
</pre></div>
</div>
</div>
<div class="section" id="exact-a-optimal-design-misocp">
<h2>Exact A-optimal design: MISOCP<a class="headerlink" href="#exact-a-optimal-design-misocp" title="Permalink to this headline">Â¶</a></h2>
<p>In the exact version of A-optimality, a number <img class="math" src="_images/math/b6d4dca7148efdbd28a438a71982603a99461287.png" alt="N \in \mathbb{N}"/>
of experiments is given, and the goal is to find the optimal number of times
<img class="math" src="_images/math/603c11f1079ac46c3e1dc1b5d1bcf5def34be9b5.png" alt="n_i \in \mathbb{N}"/> that the experiment #i should be performed,
with <img class="math" src="_images/math/a6e8bca2ddca8039c8ba833e2c852bdf01f87bbd.png" alt="\sum_i n_i =N"/>.</p>
<p>The SOCP formulation of A-optimality for constrained designs
also accept integer constraints, which results in a MISOCP for exact A-optimality:</p>
<div class="math">
<p><img src="_images/math/0e3d8d04c8f040f23e451c31b909c6e60b761610.png" alt="\begin{center}
\begin{eqnarray*}
&amp;\underset{\substack{\mathbf{t} \in \mathbb{R}^s\\
                     \mathbf{n} \in \mathbb{N}^s\\
                     \forall i \in [s],\ Z_i \in \mathbb{R}^{l_i \times m}}}{\mbox{minimize}}
                   &amp; \sum_{i=1}^s t_i\\
&amp;\mbox{subject to} &amp; \sum_{i=1}^s A_i Z_i = I\\
&amp;                  &amp; \forall i \in [s],\ \Vert Z_i \Vert_F^2 \leq n_i t_i,\\
&amp;                  &amp; \sum_{i=1}^s n_i = N.
\end{eqnarray*}
\end{center}"/></p>
</div><p>The exact optimal design is <img class="math" src="_images/math/c9ef56e80463e6896aeefd472a49260cf725cb98.png" alt="\mathbf{n}=[0,0,5,3,2,2,3,5]"/>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#create the problem, variables and params</span>
<span class="n">prob_exact_A</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<span class="n">AA</span><span class="o">=</span><span class="p">[</span><span class="n">cvx</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">tc</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span> <span class="c">#each AA[i].T is a 3 x 5 observation matrix</span>
<span class="n">s</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">AA</span><span class="p">)</span>
<span class="n">m</span><span class="o">=</span><span class="n">AA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">AA</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">)</span>
<span class="n">cc</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="c">#number of experiments allowed</span>
<span class="n">I</span> <span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;I&#39;</span><span class="p">,</span><span class="n">cvx</span><span class="o">.</span><span class="n">spmatrix</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">),(</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">)))</span> <span class="c">#identity matrix</span>
<span class="n">Z</span><span class="o">=</span><span class="p">[</span><span class="n">prob_exact_A</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;Z[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
<span class="n">n</span><span class="o">=</span><span class="n">prob_exact_A</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;n&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span> <span class="n">vtype</span><span class="o">=</span><span class="s">&#39;integer&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">=</span><span class="n">prob_exact_A</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>

<span class="c">#define the constraints and objective function</span>
<span class="n">prob_exact_A</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">(</span>
        <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">&lt;</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#constraints</span>
        <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
        <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
        <span class="p">)</span>
<span class="n">prob_exact_A</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
        <span class="n">pic</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
        <span class="p">[</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span> <span class="c">#summands</span>
        <span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="c">#index</span>
        <span class="s">&#39;[s]&#39;</span> <span class="c">#set to which the index belongs</span>
        <span class="p">)</span>
        <span class="o">==</span> <span class="n">I</span> <span class="p">)</span>

<span class="n">prob_exact_A</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span> <span class="mi">1</span><span class="o">|</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">N</span> <span class="p">)</span>
<span class="n">prob_exact_A</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="s">&#39;min&#39;</span><span class="p">,</span><span class="mi">1</span><span class="o">|</span><span class="n">t</span><span class="p">)</span>

<span class="c">#solve the problem and display the optimal design</span>
<span class="k">print</span> <span class="n">prob_exact_A</span>
<span class="n">prob_exact_A</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s">&#39;mosek&#39;</span><span class="p">,</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="n">n</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>---------------------
optimization problem  (MISOCP):
136 variables, 26 affine constraints, 136 vars in 8 SO cones

Z       : list of 8 variables, (3, 5), continuous
n       : (8, 1), integer
t       : (8, 1), continuous

        minimize â© |1| | t âª
such that
||Z[i]||^2 &lt; ( n[i])( t[i]) for all i in [s]
Î£_{i in [s]} A[i]*Z[i] = I
â© |1| | n âª &lt; N
---------------------
[...]
[...]
[ 5.00e+00]
[ 3.00e+00]
[ 2.00e+00]
[ 2.00e+00]
[ 3.00e+00]
[ 5.00e+00]
</pre></div>
</div>
</div>
<div class="section" id="approximate-and-exact-d-optimal-design-mi-socp">
<h2>approximate and exact D-optimal design: (MI)SOCP<a class="headerlink" href="#approximate-and-exact-d-optimal-design-mi-socp" title="Permalink to this headline">Â¶</a></h2>
<p>The D-optimal design problem has a convex programming formulation:</p>
<div class="math">
<p><img src="_images/math/632847344cd68b05688442d3939fb171d8f50cfc.png" alt="\begin{center}
\begin{eqnarray*}
&amp;\underset{\substack{\mathbf{L} \in \mathbb{R}^{m \times m}\\
                     \mathbf{w} \in \mathbb{R}^s\\
                     \forall i \in [s],\ V_i \in \mathbb{R}^{l_i \times m}}}{\mbox{maximize}}
                   &amp; \log \prod_{i=1}^m L_{i,i}\\
&amp;\mbox{subject to} &amp; \sum_{i=1}^s A_i V_i = L,\\
&amp;                  &amp; L\ \mbox{lower triangular},\\
&amp;                  &amp; \Vert V_i \Vert_F \leq \sqrt{m}\ w_i,\\
&amp;                  &amp; \sum_{i=1}^s w_i \leq 1.
\end{eqnarray*}
\end{center}"/></p>
</div><p>By introducing new SOC constraints, we can create a variable <img class="math" src="_images/math/befb72c6192d42cdd90540769993d922d3e9b3c0.png" alt="u_{01234}"/>
such that <img class="math" src="_images/math/32b7854606e6ffd3e5ac499153fc4ef354ae0feb.png" alt="u_{01234}^8 \leq \prod_{i=0}^4 L_{i,i}"/>. Hence, the
D-optimal problem can be solved by second order cone programming. The example
below allocates respectively 22.7%, 3.38%, 1.65%, 5.44%, 31.8% and 35.1%
to the experiments #3 to #8.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#create the problem, variables and params</span>
<span class="n">prob_D</span> <span class="o">=</span> <span class="n">pic</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<span class="n">AA</span><span class="o">=</span><span class="p">[</span><span class="n">cvx</span><span class="o">.</span><span class="n">sparse</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">tc</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span> <span class="c">#each AA[i].T is a 3 x 5 observation matrix</span>
<span class="n">s</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">AA</span><span class="p">)</span>
<span class="n">m</span><span class="o">=</span><span class="n">AA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">AA</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">)</span>
<span class="n">mm</span><span class="o">=</span><span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
<span class="n">L</span><span class="o">=</span><span class="n">prob_D</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;L&#39;</span><span class="p">,(</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">))</span>
<span class="n">V</span><span class="o">=</span><span class="p">[</span><span class="n">prob_D</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;V[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
<span class="n">w</span><span class="o">=</span><span class="n">prob_D</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
<span class="c">#additional variables to handle the product of the diagonal elements of L</span>
<span class="n">u</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;01&#39;</span><span class="p">,</span><span class="s">&#39;23&#39;</span><span class="p">,</span><span class="s">&#39;4.&#39;</span><span class="p">,</span><span class="s">&#39;0123&#39;</span><span class="p">,</span><span class="s">&#39;4...&#39;</span><span class="p">,</span><span class="s">&#39;01234&#39;</span><span class="p">]:</span>
        <span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob_D</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;u[&#39;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>


<span class="c">#define the constraints and objective function</span>
<span class="n">prob_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
                <span class="n">pic</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="s">&#39;[s]&#39;</span><span class="p">)</span>
                <span class="o">==</span> <span class="n">L</span><span class="p">)</span>
<span class="c">#L is lower triangular</span>
<span class="n">prob_D</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">(</span> <span class="p">[</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">)],[</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="s">&#39;j&#39;</span><span class="p">],</span><span class="s">&#39;upper triangle&#39;</span><span class="p">)</span>
<span class="n">prob_D</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&lt;</span><span class="p">(</span><span class="n">mm</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="s">&#39;[s]&#39;</span><span class="p">)</span>
<span class="n">prob_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="mi">1</span><span class="o">|</span><span class="n">w</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#SOC constraints to define u[&#39;01234&#39;] such that u[&#39;01234&#39;]**8 &lt; L[0,0] * L[1,1] * ... * L[4,4]</span>
<span class="n">prob_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;01&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>   <span class="o">&lt;</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">prob_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;23&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>   <span class="o">&lt;</span><span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">prob_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;4.&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>   <span class="o">&lt;</span><span class="n">L</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">prob_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;0123&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;01&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;23&#39;</span><span class="p">])</span>
<span class="n">prob_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;4...&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;4.&#39;</span><span class="p">])</span>
<span class="n">prob_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;01234&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">&lt;</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;0123&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;4...&#39;</span><span class="p">])</span>

<span class="n">prob_D</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="s">&#39;max&#39;</span><span class="p">,</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;01234&#39;</span><span class="p">])</span>

<span class="c">#solve the problem and display the optimal design</span>
<span class="k">print</span> <span class="n">prob_D</span>
<span class="n">prob_D</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="n">w</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>---------------------
optimization problem  (SOCP):
159 variables, 36 affine constraints, 146 vars in 14 SO cones

V   : list of 8 variables, (3, 5), continuous
u   : dict of 6 variables, (1, 1), continuous
L   : (5, 5), continuous
w   : (8, 1), continuous

        maximize u[01234]
such that
L = Î£_{i in [s]} A[i]*V[i]
L[i,j] = 0 for all (i,j) in upper triangle
||V[i]|| &lt; (m)**0.5*w[i] for all i in [s]
â© |1| | w âª &lt; 1.0
||u[01]||^2 &lt; ( L[0,0])( L[1,1])
||u[23]||^2 &lt; ( L[2,2])( L[3,3])
||u[4.]||^2 &lt; L[4,4]
||u[0123]||^2 &lt; ( u[01])( u[23])
||u[4...]||^2 &lt; u[4.]
||u[01234]||^2 &lt; ( u[0123])( u[4...])
---------------------
[...]
[...]
[ 2.27e-01]
[ 3.38e-02]
[ 1.65e-02]
[ 5.44e-02]
[ 3.18e-01]
[ 3.51e-01]
</pre></div>
</div>
<p>As for the A-optimal problem, there is an alternative SOCP formulation
of D-optimality <a class="reference internal" href="#optdes-refs"><em>[2]</em></a>, in which integer constraints may be added.
This allows us to formulate the exact D-optimal problem as a MISOCP.
For <img class="math" src="_images/math/be3653123b5af2b70aa19b8001a18ee49a228d0a.png" alt="N=20"/>,
we obtain the following N-exact D-optimal design:
<img class="math" src="_images/math/09962f49bab64d6173b8e4304637eb66f2c02151.png" alt="\mathbf{n}=[0,0,5,1,0,1,6,7]"/>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#create the problem, variables and params</span>
<span class="n">prob_exact_D</span> <span class="o">=</span> <span class="n">pic</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>
<span class="n">L</span><span class="o">=</span><span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;L&#39;</span><span class="p">,(</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">))</span>
<span class="n">V</span><span class="o">=</span><span class="p">[</span><span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;V[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
<span class="n">T</span><span class="o">=</span><span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">,(</span><span class="n">s</span><span class="p">,</span><span class="n">m</span><span class="p">))</span>
<span class="n">n</span><span class="o">=</span><span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;n&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="s">&#39;integer&#39;</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">pic</span><span class="o">.</span><span class="n">new_param</span><span class="p">(</span><span class="s">&#39;N&#39;</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="c">#additional variables to handle the product of the diagonal elements of L</span>
<span class="n">u</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;01&#39;</span><span class="p">,</span><span class="s">&#39;23&#39;</span><span class="p">,</span><span class="s">&#39;4.&#39;</span><span class="p">,</span><span class="s">&#39;0123&#39;</span><span class="p">,</span><span class="s">&#39;4...&#39;</span><span class="p">,</span><span class="s">&#39;01234&#39;</span><span class="p">]:</span>
        <span class="n">u</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span><span class="s">&#39;u[&#39;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>


<span class="c">#define the constraints and objective function</span>
<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span>
                <span class="n">pic</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">AA</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)],</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="s">&#39;[s]&#39;</span><span class="p">)</span>
                <span class="o">==</span> <span class="n">L</span><span class="p">)</span>
<span class="c">#L is lower triangular</span>
<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">(</span> <span class="p">[</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">)],[</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="s">&#39;j&#39;</span><span class="p">],</span><span class="s">&#39;upper triangle&#39;</span><span class="p">)</span>

<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span><span class="n">k</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">&lt;</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">N</span><span class="o">*</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)],[</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">])</span>

<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_list_of_constraints</span><span class="p">([(</span><span class="mi">1</span><span class="o">|</span><span class="n">T</span><span class="p">[:,</span><span class="n">k</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">1</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)],</span><span class="s">&#39;k&#39;</span><span class="p">)</span>


<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="mi">1</span><span class="o">|</span><span class="n">n</span><span class="o">&lt;</span><span class="n">N</span><span class="p">)</span>

<span class="c">#SOC constraints to define u[&#39;01234&#39;] such that u[&#39;01234&#39;]**8 &lt; L[0,0] * L[1,1] * ... * L[4,4]</span>
<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;01&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>   <span class="o">&lt;</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;23&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>   <span class="o">&lt;</span><span class="n">L</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;4.&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>   <span class="o">&lt;</span><span class="n">L</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;0123&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;01&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;23&#39;</span><span class="p">])</span>
<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;4...&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;4.&#39;</span><span class="p">])</span>
<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;01234&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">&lt;</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;0123&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;4...&#39;</span><span class="p">])</span>

<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">set_objective</span><span class="p">(</span><span class="s">&#39;max&#39;</span><span class="p">,</span><span class="n">u</span><span class="p">[</span><span class="s">&#39;01234&#39;</span><span class="p">])</span>

<span class="c">#solve the problem and display the optimal design</span>
<span class="k">print</span> <span class="n">prob_exact_D</span>
<span class="n">prob_exact_D</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s">&#39;mosek&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span> <span class="n">n</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre>---------------------
optimization problem  (MISOCP):
199 variables, 41 affine constraints, 218 vars in 46 SO cones

V       : list of 8 variables, (3, 5), continuous
u       : dict of 6 variables, (1, 1), continuous
L       : (5, 5), continuous
T       : (8, 5), continuous
n       : (8, 1), integer

        maximize u[01234]
such that
L = Î£_{i in [s]} A[i]*V[i]
L[i,j] = 0 for all (i,j) in upper triangle
||V[i][:,k]||^2 &lt; ( n[i] / N)( T[i,k]) for all (i,k)
â© |1| | T[:,k] âª &lt; 1.0 for all k
â© |1| | n âª &lt; N
||u[01]||^2 &lt; ( L[0,0])( L[1,1])
||u[23]||^2 &lt; ( L[2,2])( L[3,3])
||u[4.]||^2 &lt; L[4,4]
||u[0123]||^2 &lt; ( u[01])( u[23])
||u[4...]||^2 &lt; u[4.]
||u[01234]||^2 &lt; ( u[0123])( u[4...])
---------------------
[...]
[...]
[ 5.00e+00]
[ 1.00e+00]
[...]
[ 1.00e+00]
[ 6.00e+00]
[ 7.00e+00]
</pre></div>
</div>
</div>
<div class="section" id="references">
<span id="optdes-refs"></span><h2>References<a class="headerlink" href="#references" title="Permalink to this headline">Â¶</a></h2>
<blockquote>
<div><ol class="arabic simple">
<li>&#8220;<a class="reference external" href="http://arxiv.org/abs/0912.5467">Computing Optimal Designs of multiresponse Experiments reduces to
Second-Order Cone Programming</a>&#8221;, G. Sagnol,
<em>Journal of Statistical Planning and Inference</em>,
141(5), p. <em>1684-1708</em>, 2011.</li>
<li>&#8220;<cite>SOC-representability of the D-criterion of optimal experimental design</cite>&#8221;,
R. Harman and G. Sagnol, Draft.</li>
</ol>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="tuto.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Examples from Optimal Experimental Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="graphs.html">Cut problems in graphs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">The PICOS API</a></li>
<li class="toctree-l1"><a class="reference internal" href="download.html">Download</a></li>
</ul>

  <h3><a href="index.html">Contents of this page</a></h3>
  <ul>
<li><a class="reference internal" href="#">Examples from Optimal Experimental Design</a><ul>
<li><a class="reference internal" href="#c-optimality-multi-response-socp">c-optimality, multi-response: SOCP</a><ul>
<li><a class="reference internal" href="#primal-problem">Primal Problem</a></li>
<li><a class="reference internal" href="#dual-problem">Dual Problem</a></li>
</ul>
</li>
<li><a class="reference internal" href="#c-optimality-single-response-lp">c-optimality, single-response: LP</a></li>
<li><a class="reference internal" href="#sdp-formulation-of-the-c-optimal-design-problem">SDP formulation of the c-optimal design problem</a><ul>
<li><a class="reference internal" href="#id1">Primal Problem</a></li>
<li><a class="reference internal" href="#id2">Dual Problem</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-optimality-socp">A-optimality: SOCP</a><ul>
<li><a class="reference internal" href="#id3">Primal Problem</a></li>
<li><a class="reference internal" href="#id4">Dual Problem</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-optimality-with-multiple-constraints-socp">A-optimality with multiple constraints: SOCP</a></li>
<li><a class="reference internal" href="#exact-a-optimal-design-misocp">Exact A-optimal design: MISOCP</a></li>
<li><a class="reference internal" href="#approximate-and-exact-d-optimal-design-mi-socp">approximate and exact D-optimal design: (MI)SOCP</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="examples.html"
                        title="previous chapter">Examples</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="graphs.html"
                        title="next chapter">Cut problems in graphs</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/optdes.txt"
           rel="nofollow">Show Source</a></li>
  </ul>

  <h3><a href="download.html">Download</a></h3>
  <ul class="this-page-menu">
    <li><a href="dist/PICOS-0.1.2.tar.gz" onClick="javascript: _gaq.push(['_trackPageview', '/downloads/version012']);" onClick="javascript: _gaq.push(['_trackPageview', '/downloads/version012']);">Latest Version (0.1.2)</a></li>
  </ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="graphs.html" title="Cut problems in graphs"
             >next</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Examples"
             >previous</a> |</li>
        <li><a href="index.html">PICOS</a> &raquo;</li>
          <li><a href="examples.html" >Examples</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Guillaume Sagnol.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>